{"version":3,"sources":["app/app.controller.js","app/treeMap/controller.js","app/treeMap/directive.js","app/treeMapDiv/controller.js","app/treeMapDiv/directive.js","common/neo4jD3/neo4j.js","common/neo4jD3/neo4jD3.js","app/app.module.js","app/treeMap/module.js","app/treeMapDiv/module.js","common/color/module.js","common/globalEvents/module.js","common/neo4jD3/module.js","app/app.config.js","app/app.libraries.js","app/app.settings.js","common/color/hex.js","common/color/hsl.js","common/color/rgb.js","common/d3Colors/d3Colors.js","common/globalEvents/service.js"],"names":["AppCtrl","$window","$","_","globalEvents","this","on","debounce","trigger","TreeMapCtrl","$element","$q","d3","neo4jD3","HEX","D3Colors","settings","$d3Element","find","_visibleDepth","currentLevel","treeMap","width","height","numColors","steps","colors","scale","category10","domain","range","getScaledFadedColors","x","linear","y","el","layout","treemap","children","d","depth","_children","sort","a","b","value","ratio","Math","sqrt","round","element","select","attr","append","style","node","grandParent","$grandParent","json","error","data","console","warn","draw","bind","treeMapDirective","controller","controllerAs","restrict","replace","templateUrl","TreeMapDivCtrl","currentDepth","classed","grandparent","then","treeMapDivDirective","Neo4J","$resource","url","user","password","query","method","headers","Accept","Content-type","Authorization","btoa","isArray","buildTree","results","child","currentChild","currentDataSet","currentParent","dataSet","i","len","parent","childIndex","owl:Thing","nodes","name","columns","length","row","dataSets","numDataSets","ontID","uri","push","uuid","JSON","parse","stringify","Neo4jD3","d3Deferred","defer","neo4jUrl","neo4jUser","neo4jPassword","statements","statement","$promise","response","errors","start","Date","getTime","d3Data","resolve","end","time","log","reject","neo4jResponse","promise","angular","module","config","constant","jQuery","noConflict","treeMapFadeInDuration","treeMapZoomDuration","prototype","accumulateAndPrune","valueProp","accumulateAndPruneChildren","numChildren","meta","originalDepth","numChildChildren","call","pseudoNode","j","skipped","unshift","splice","leaf","addChildren","level","firstTime","childChildNode","that","promises","selectAll","enter","visibleDepth","each","childChildren","addInnerNodes","childrensLeafs","filter","leafs","color","rect","addLabel","animateEls","concat","fadeIn","all","addEventListeners","transition","__data__","parents","parentsWithChildren","innerNodes","colorRgb","contrastBlack","contrast","toRgb","contrastWhite","text","addLevelsOfNodes","oldLevel","currentInnerNodes","startLevel","remove","adjustLevelDepth","newLevel","removeLevelsOfNodes","hex","rgb","colorHex","colorMode","branchNo","min","max","revDepth","colorEl","attribute","display","setBreadCrumb","formerGroupWrapper","groupWrapper","datum","initialize","selection","defers","index","duration","random","delay","dx","dy","cache","elements","reduction","group","undefined","insert","transitioning","newGroupsTrans","formerGroupWrapperTrans","newGroups","e","Object","defineProperty","configurable","enumerable","writable","get","set","directive","classes","visibility","coordinates","aspectRatio","nodesAtLevel","$el","css","opacity","transform","requestNextAnimationFrame","parseInt","addClickListener","event","from","to","hidden","browseMode","mode","area","absX","absY","scaleX","scaleY","originX","originY","centerAdjustmentX","centerAdjustmentY","factory","$injector","constructor","toHsl","RGB","result","exec","toString","_hex","Error","match","HSL","hue","saturation","lightness","brighten","noLast","lStep","toHex","hueToRgb","p","q","t","r","g","_hue","_lightness","_saturation","service","red","green","blue","h","s","l","slice","luminosity","lum","absValue","relValue","pow","lum1","lum2","_blue","Number","_green","_red","_colors","fadedColors","hsl","ordinal","GlobalEvents","private","eventStack","off","callback","stack","isFunction"],"mappings":"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","file":"app.js","sourcesContent":["function AppCtrl ($window, $, _, globalEvents) {\n  this.$ = $;\n  this._ = _;\n\n  this.$($window).on('resize orientationchange', this._.debounce(\n    function () {\n      globalEvents.trigger('resize');\n    },\n    250\n  ));\n}\n\nangular\n  .module('treeMapApp')\n  .controller('AppCtrl', [\n    '$window',\n    '$',\n    '_',\n    'globalEvents',\n    AppCtrl\n  ]);\n","/* global angular:false */\n\n/**\n * TreeMap controller constructor.\n *\n * @method  TreeMapCtrl\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @param   {Object}     $element  Directive's root element.\n * @param   {Object}     $q        Angular's promise service.\n * @param   {Object}     $         jQuery.\n * @param   {Object}     d3        D3.\n * @param   {Object}     neo4jD3   Neo4J to D3 converter.\n * @param   {Object}     HEX       HEX class.\n * @param   {Object}     D3Colors  Service for creating D3 color scalings.\n * @param   {Object}     settings  App wide this.settings.\n */\nfunction TreeMapCtrl ($element, $q, $, d3, neo4jD3, HEX, D3Colors, settings) {\n  this.$ = $;\n  this.$q = $q;\n  this.d3 = d3;\n  this.HEX = HEX;\n  this.$element = this.$($element),\n  this.$d3Element = this.$element.find('.treeMap svg');\n  this.settings = settings;\n\n  this._visibleDepth = 3;\n  this.currentLevel = 0;\n\n  this.treeMap.width = this.$d3Element.width();\n  this.treeMap.height = this.$d3Element.height();\n\n  this.numColors = 10;\n  this.steps = 6;\n\n  this.treeMap.colors = new D3Colors(\n    this.d3.scale.category10().domain(d3.range(this.numColors)).range()\n  ).getScaledFadedColors(this.steps);\n\n  this.treeMap.x = this.d3.scale.linear()\n    .domain([0, this.treeMap.width])\n    .range([0, this.treeMap.width]);\n\n  this.treeMap.y = this.d3.scale.linear()\n    .domain([0, this.treeMap.height])\n    .range([0, this.treeMap.height]);\n\n  this.treeMap.el = this.d3.layout.treemap()\n    .children(function(d, depth) { return depth ? null : d._children; })\n    .sort(function(a, b) { return a.value - b.value; })\n    .ratio(this.treeMap.height / this.treeMap.width * 0.5 * (1 + Math.sqrt(5)))\n    .round(false);\n\n  this.treeMap.element = this.d3.select(this.$d3Element[0])\n    .attr('viewBox', '0 0 ' + this.treeMap.width + ' ' + this.treeMap.height)\n    .append('g')\n      .style('shape-rendering', 'crispEdges');\n  this.treeMap.$element = this.$(this.treeMap.element.node());\n\n  this.treeMap.grandParent = this.d3.select('#back');\n  this.treeMap.$grandParent = this.$(this.treeMap.grandParent.node());\n\n  /* ---------------------------- [START: STATIC] --------------------------- */\n  this.d3.json('../data/cl.json', function(error, data) {\n    if (error) return console.warn(error);\n    this.data = data;\n    this.draw();\n  }.bind(this));\n  /* ----------------------------- [END: STATIC] ---------------------------- */\n\n  /* ----------------------------- [START: LIVE] ---------------------------- */\n  // neo4jD3.d3\n  //   .then(function (data) {\n  //     this.data = data;\n  //     this.draw();\n  //   }.bind(this));\n  /* ------------------------------ [END: LIVE] ----------------------------- */\n}\n\n/*\n * -----------------------------------------------------------------------------\n * Methods\n * -----------------------------------------------------------------------------\n */\n\n/**\n * Starter function for aggrgation and pruning.\n *\n * @method  addChildren\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @param   {Object}  data        D3 data object.\n * @param   {String}  valueProp   Name of the property holding the value.\n */\nTreeMapCtrl.prototype.accumulateAndPrune = function (data, valueProp) {\n  var numChildren = data.children ? data.children.length : false;\n  data.meta = data.meta || {};\n\n  if (numChildren) {\n    accumulateAndPruneChildren.call(this, data, numChildren, valueProp, 0);\n    if (data.value) {\n      data.value += data[valueProp];\n    } else {\n      data.value = data[valueProp];\n    }\n  }\n\n  /**\n   * Recursively accumulate `valueProp` values and prune _empty_ leafs.\n   *\n   * This function traverses all inner loops and stops one level BEFORE a leaf\n   * to be able to splice (delete) empty leafs from the list of children\n   *\n   * @method  addChildren\n   * @author  Fritz Lekschas\n   * @date    2015-08-04\n   * @param   {Object}   node         D3 data object of the node.\n   * @param   {Number}   numChildren  Number of children of `node.\n   * @param   {String}   valueProp    Property name of the propery holding the\n   *   value of the node's _size_.\n   * @param   {Number}   depth        Original depth of the current node.\n   * @param   {Boolean}  root         If node is the root.\n   */\n  function accumulateAndPruneChildren (node, numChildren, valueProp, depth) {\n    // A reference for later\n    node._children = node.children;\n    node.meta.originalDepth = depth;\n    var i = numChildren;\n    // We move in reverse order so that deleting nodes doesn't affect future\n    // indices.\n    while (i--) {\n      var child = node.children[i];\n      var numChildChildren = child.children ? child.children.length : false;\n\n      child.meta = child.meta || {};\n\n      if (numChildChildren) {\n        // Inner node.\n        accumulateAndPruneChildren.call(\n          this, child, numChildChildren, valueProp, depth + 1\n        );\n        numChildChildren = child.children.length;\n      }\n\n      // We check again the number of children of the child since it can happen\n      // that all children have been deleted meanwhile and the inner node became\n      // a leaf as well.\n      if (numChildChildren) {\n        // Inner node.\n        if (child[valueProp]) {\n          // Add own `numDataSets` to existing `value`.\n          child.value += child[valueProp];\n          // To represent this node visually in the tree map we need to create\n          // a \"fake\" child, i.e. pseudo node, holding the values of this inner\n          // node.\n          child.children.push({\n            name: child.name,\n            meta: {\n              originalDepth: child.depth + 1,\n              pseudoNode: true\n            },\n            value: child[valueProp]\n          });\n          child.children[child.children.length - 1][valueProp] = child[valueProp];\n        } else {\n          // We prune `child`, i.e. remove, a node in two cases\n          // A) `child` is the only child of `node` or\n          // B) `child` only has one child.\n          // This way we ensure that the out degree of `child` is two or higher.\n          if (numChildren === 1 || numChildChildren === 1) {\n            // We can remove the inner node since it wasn't used for any\n            // annotations.\n            for (var j = 0, len = child.children.length; j < len; j++) {\n              if (child.children[j].meta.skipped) {\n                child.children[j].meta.skipped.unshift(child.name);\n              } else {\n                child.children[j].meta.skipped = [child.name];\n              }\n              node.children.push(child.children[j]);\n            }\n            // Remove the child with the empty valueProp\n            node.children.splice(i, 1);\n          }\n        }\n      } else {\n        // Leaf.\n        if (!child[valueProp]) {\n          // Leaf was not used for annotation so we remove it.\n          node.children.splice(i, 1);\n          numChildren--;\n          continue;\n        } else {\n          // Set `value` of the leaf itself.\n          child.value = child[valueProp];\n          child.meta.leaf = true;\n          child.meta.originalDepth = depth + 1;\n        }\n      }\n\n      // Increase `value` if the node by the children's `numDataSets`.\n      if (typeof node.value !== 'undefined') {\n        node.value += child.value;\n      } else {\n        node.value = child.value;\n      }\n    }\n  }\n};\n\n/**\n * Recursively adds children to the parent for `this.visibleDepth` levels.\n *\n * @method  addChildren\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @param   {Object}   parent     D3 selection of parent.\n * @param   {Object}   data       D3 data object of `parent`.\n * @param   {Number}   level      Current level of depth.\n * @param   {Boolean}  firstTime  When `true` triggers a set of initializing\n *   animation.\n * @return  {Object}              D3 selection of `parent`'s children.\n */\nTreeMapCtrl.prototype.addChildren = function (parent, data, level, firstTime) {\n  var that = this,\n      childChildNode,\n      promises = [];\n\n  // Create a `g` wrapper for all children.\n  var children = parent.selectAll('.group-of-nodes')\n    .data(data._children)\n    .enter()\n      .append('g')\n      .attr('class', 'group-of-nodes');\n\n  // Recursion\n  if (level < this.currentLevel + this.visibleDepth) {\n    this.children[level + 1] = this.children[level + 1] || [];\n    children.each(function (data) {\n      if (data._children && data._children.length) {\n        var childChildren = that.addChildren(\n          that.d3.select(this), data, level + 1, firstTime);\n        that.children[level + 1].push(childChildren[0]);\n        promises.push(childChildren[1]);\n      }\n    });\n  } else {\n    /* Final level, i.e. `level === this.visibleDepth`.\n     *\n     * Since we only call the recursion as long as `level` is smaller than\n     * `this.visibleDepth` this else statement will only be reached when both\n     * variables are the same.\n     *\n     * On the final level we add \"inner nodes\"\n     */\n\n    childChildNode = this.addInnerNodes(children);\n  }\n\n  // D3 selection of all children without any children, i.e. leafs.\n  var childrensLeafs = children.filter(function(child) {\n      return !(child._children && child._children.length);\n    });\n\n  var leafs = childrensLeafs\n    .selectAll('.leaf-node')\n    .data(function (data) {\n      return [data];\n    })\n    .enter()\n    .append('g')\n      .attr('class', 'leaf-node')\n      .attr('opacity', 0);\n\n  leafs\n    .append('rect')\n      .attr('class', 'leaf')\n      .attr('fill', this.color.bind(this))\n      .call(this.rect.bind(this));\n\n  leafs\n    .call(this.addLabel.bind(this), 'name');\n\n  // Merge `leaf` and `childChildNode` selections. This turns out to be\n  var animateEls = leafs;\n  if (!leafs.length) {\n    animateEls = childrensLeafs;\n  }\n  if (childChildNode && childChildNode.length) {\n    animateEls[0] = animateEls[0].concat(childChildNode[0]);\n  }\n\n  promises = promises.concat(this.fadeIn(animateEls, firstTime));\n\n  return [children, this.$q.all(promises)];\n};\n\n/**\n * Adds global event listeners using jQuery.\n *\n * @method  addEventListeners\n * @author  Fritz Lekschas\n * @date    2015-08-04\n */\nTreeMapCtrl.prototype.addEventListeners = function () {\n  var that = this;\n\n  this.treeMap.$grandParent.on('click', 'a', function () {\n    /*\n     * that = TreeMapCtrl\n     * this = the clicked DOM element\n     * data = data\n     */\n    that.transition(this, this.__data__);\n  });\n  this.treeMap.$element.on(\n    'click',\n    '.label-wrapper, .outer-border',\n    function () {\n      /*\n       * that = TreeMapCtrl\n       * this = the clicked DOM element\n       * data = data\n       */\n      that.transition(this, this.__data__);\n    }\n  );\n};\n\n/**\n * Add inner nodes\n *\n * @method  addInnerNodes\n * @author  Fritz Lekschas\n * @date    2015-08-05\n * @param   {[type]}       parents  [description]\n */\nTreeMapCtrl.prototype.addInnerNodes = function (parents) {\n  // D3 selection of all children with children\n  var parentsWithChildren = parents.filter(function(parent) {\n    return parent._children && parent._children.length;\n  });\n\n  innerNodes = parentsWithChildren\n    .append('g')\n      .attr('class', 'inner-node')\n      .attr('opacity', 0);\n\n  innerNodes\n    .append('rect')\n      .attr('class', 'inner-border')\n      .attr('fill', this.color.bind(this))\n      .call(this.rect.bind(this), 1);\n\n  innerNodes\n    .append('rect')\n    .attr('class', 'outer-border')\n    .call(this.rect.bind(this));\n\n  innerNodes\n    .call(this.addLabel.bind(this), 'name');\n\n  return innerNodes;\n};\n\n/**\n * Appends a `foreignObject` into SVG holding a `DIV`\n *\n * @method  addLabel\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @param   {Object}    el    D3 selection.\n * @param   {String}    attr  Attribute name which holds the label's text.\n */\nTreeMapCtrl.prototype.addLabel = function (el, attr) {\n  var that = this;\n\n  el.append('foreignObject')\n    .attr('class', 'label-wrapper')\n    .call(this.rect.bind(this), 2)\n    .append('xhtml:div')\n      .attr('class', 'label')\n      .attr('title', function(data) {\n          return data[attr];\n      })\n      .classed('label-bright', function (data) {\n        if (data.meta.colorRgb) {\n          var contrastBlack = data.meta.colorRgb\n              .contrast(new that.HEX('#000000').toRgb()),\n            contrastWhite = data.meta.colorRgb\n              .contrast(new that.HEX('#ffffff').toRgb());\n          return contrastBlack < contrastWhite;\n        }\n      })\n      .text(function(data) {\n          return data[attr];\n      });\n};\n\n/**\n * Add levels of children starting from level `level` until `this.numLevels`.\n *\n * @method  addLevelsOfNodes\n * @author  Fritz Lekschas\n * @date    2015-08-03\n * @param   {Number}  oldLevel  Starting level.\n */\nTreeMapCtrl.prototype.addLevelsOfNodes = function (oldLevel) {\n  var currentInnerNodes = this.d3.selectAll('.inner-node'),\n    promises = [],\n    startLevel = this.currentLevel + oldLevel,\n    that = this;\n\n  this.children[startLevel + 1] = this.children[startLevel + 1] || [];\n  for (var i = 0, len = this.children[startLevel].length; i < len; i++) {\n    this.children[startLevel][i].each(function (data) {\n      if (data._children && data._children.length) {\n        var children = that.addChildren(\n          that.d3.select(this), data, startLevel + 1);\n        that.children[startLevel + 1].push(children[0]);\n        promises.push(children[1]);\n      }\n    });\n  }\n\n  // Remove formerly displayed inner nodes after all new inner nodes have been\n  // faded in.\n  this.$q.all(promises)\n    .then(function () {\n      currentInnerNodes.remove();\n    });\n};\n\n/**\n * Helper function that decides whether nodes have to be added or removed\n *\n * @method  adjustLevelDepth\n * @author  Fritz Lekschas\n * @date    2015-08-05\n * @param   {Number}  oldLevel  Former level of depth.\n * @param   {Number}  newLevel  New level of depth.\n */\nTreeMapCtrl.prototype.adjustLevelDepth = function (oldLevel, newLevel) {\n  var that = this;\n\n  if (oldLevel < newLevel) {\n    this.addLevelsOfNodes(oldLevel);\n  }\n  if (oldLevel > newLevel) {\n    this.removeLevelsOfNodes(oldLevel);\n  }\n};\n\n/**\n * Generate a color given an elements node data object.\n *\n * @method  color\n * @author  Fritz Lekschas\n * @date    2015-07-31\n * @param   {Object}  node  D3 node data object.\n * @return  {String}        HEX color string.\n */\nTreeMapCtrl.prototype.color = function (node) {\n  var hex, rgb;\n\n  if (node.meta.colorHex) {\n    return node.meta.colorHex;\n  }\n\n  if (this.colorMode === 'depth') {\n    // Color by original depth\n    // The deeper the node, the lighter the color\n    hex = this.treeMap.colors((node.meta.branchNo[0] * this.steps) +\n      Math.min(this.steps, node.meta.originalDepth) - 1);\n  } else {\n    // Default:\n    // Color by reverse final depth (after pruning). The fewer children a node\n    // has, the lighter the color. E.g. a leaf is lightest while the root is\n    // darkest.\n    hex = this.treeMap.colors((node.meta.branchNo[0] * this.steps) +\n      Math.max(0, this.steps - node.meta.revDepth - 1));\n  }\n\n  // Precompute RGB\n  rgb = new this.HEX(hex).toRgb();\n\n  // Cache colors for speed\n  node.meta.colorHex = hex;\n  node.meta.colorRgb = rgb;\n\n  return hex;\n}\n\n/**\n * Provide a color to a DOM's attribute\n *\n * @method  colorEl\n * @author  Fritz Lekschas\n * @date    2015-07-31\n * @param   {Object}    element    DOM element created by D3.\n * @param   {String}    attribute  Name of attribute that should be colored.\n */\nTreeMapCtrl.prototype.colorEl = function (element, attribute) {\n  element\n    .attr(attribute, this.color.bind(this));\n};\n\n/**\n * Display the data.\n *\n * @param   {Object}  node  D3 data object of the node.\n * @return  {Object}        D3 selection of node's children.\n */\nTreeMapCtrl.prototype.display = function (node, firstTime) {\n  var that = this;\n\n  this.setBreadCrumb(node);\n\n  // Keep a reference to the old wrapper\n  this.treeMap.formerGroupWrapper = this.treeMap.groupWrapper;\n\n  // Create a new wrapper group for the children.\n  this.treeMap.groupWrapper = this.treeMap.element\n    .append('g')\n    .datum(node)\n    .attr('class', 'depth');\n\n  // For completeness we store the children of level zero.\n  this.children[0] = [this.treeMap.groupWrapper];\n\n  var children = this.addChildren(\n    this.treeMap.groupWrapper, node, 1, firstTime);\n\n  // We have to cache the children to dynamically adjust the level depth.\n  this.children[1] = [children[0]];\n\n  return children;\n};\n\n/**\n * Draw the treemap.\n *\n * @method  draw\n * @author  Fritz Lekschas\n * @date    2015-08-03\n */\nTreeMapCtrl.prototype.draw = function () {\n  if (this.data === null) {\n    return false;\n  }\n\n  this.initialize(this.data);\n  this.accumulateAndPrune(this.data, 'numDataSets');\n  this.layout(this.data, 0);\n  this.display(this.data, true);\n\n  this.addEventListeners();\n};\n\n/**\n * Fade in a selection.\n *\n * @method  fadeIn\n * @author  Fritz Lekschas\n * @date    2015-08-05\n * @param   {Object}   selection  D3 selection.\n * @param   {Boolean}  firstTime  True if triggered the first time, i.e. after\n *   the page loaded.\n * @return  {Array}              Angular promises.\n */\nTreeMapCtrl.prototype.fadeIn = function (selection, firstTime) {\n  var defers = [],\n      promises = [],\n      that = this;\n\n  selection\n    .each(function (data, index) {\n      defers[index] = that.$q.defer();\n      promises[index] = defers[index].promise;\n    });\n\n  selection\n    .transition()\n    .duration(function () {\n      if (firstTime) {\n        return that.settings.treeMapFadeInDuration + (Math.random() * that.settings.treeMapFadeInDuration);\n      }\n      return that.settings.treeMapFadeInDuration;\n    })\n    .delay(function () {\n      if (firstTime) {\n        return Math.random() * that.settings.treeMapFadeInDuration;\n      }\n      return 0;\n    })\n    .attr('opacity', 1)\n    .each('end', function (data, index) {\n      defers[index].resolve();\n    });\n\n  return promises;\n};\n\n/**\n * Initialize the root node. This would usually be computed by `treemap()`.\n *\n * @method  initialize\n * @author  Fritz Lekschas\n * @date    2015-08-03\n * @param   {Object}  data  D3 data object.\n */\nTreeMapCtrl.prototype.initialize = function (data) {\n  data.x = data.y = 0;\n  data.dx = this.treeMap.width;\n  data.dy = this.treeMap.height;\n  data.depth = 0;\n  data.meta = {\n    branchNo: []\n  };\n};\n\n/**\n * Recursively compute the layout of each node depended on its parent.\n *\n * Compute the treemap layout recursively such that each group of siblings uses\n * the same size (11) rather than the dimensions of the parent cell. This\n * optimizes the layout for the current zoom state. Note that a wrapper object\n * is created for the parent node for each group of siblings so that the\n * parent's dimensions are not discarded as we recurse. Since each group of\n * sibling was laid out in 11, we must rescale to fit using absolute\n * coordinates. This lets us use a viewport to zoom.\n *\n * @method  layout\n * @author  Fritz Lekschas\n * @date    2015-08-03\n * @param   {Object}  data  D3 data object.\n */\nTreeMapCtrl.prototype.layout = function (parent, depth) {\n  // Initialize a cache object used later\n  parent.cache = {};\n  parent.meta.depth = depth;\n  if (parent._children && parent._children.length) {\n    this.depth = Math.max(this.depth, depth + 1);\n    // This creates an anonymous 1px x 1px treemap and sets the children's\n    // coordinates accordingly.\n    this.treeMap.el({_children: parent._children});\n    for (var i = 0, len = parent._children.length; i < len; i++) {\n      var child = parent._children[i];\n      child.x = parent.x + child.x * parent.dx;\n      child.y = parent.y + child.y * parent.dy;\n      child.dx *= parent.dx;\n      child.dy *= parent.dy;\n      child.parent = parent;\n\n      child.meta.branchNo = parent.meta.branchNo.concat([i]);\n\n      this.layout(child, depth + 1);\n      parent.meta.revDepth = Math.max(\n        child.meta.revDepth + 1,\n        parent.meta.revDepth || 0\n      )\n    }\n  } else {\n    // Leaf\n    // Leafs have a reverse depth of zero.\n    parent.meta.revDepth = 0;\n  }\n};\n\n/**\n * Set the coordinates of the rectangular.\n *\n * How to invoke:\n * `d3.selectAll('rect').call(this.rect.bind(this))`\n *\n * Note: This weird looking double this is needed as the context of a `call`\n * function is actually the same as the selection passed to it, which seems\n * redundant but that's how it works right now. So to assign `TreeMapCtrl` as\n * the context we have to manually bind `this`.\n *\n * URL: https://github.com/mbostock/d3/wiki/Selections#call\n *\n * @method  rect\n * @author  Fritz Lekschas\n * @date    2015-08-03\n * @param   {Array}  elements  D3 selection of DOM elements.\n */\nTreeMapCtrl.prototype.rect = function (elements, reduction) {\n  var that = this;\n\n  reduction = reduction || 0;\n\n  elements\n    .attr('x', function (data) {\n      return that.treeMap.x(data.x) + reduction;\n    })\n    .attr('y', function (data) {\n      return that.treeMap.y(data.y) + reduction;\n    })\n    .attr('width', function (data) {\n      data.cache.width = Math.max(0, (\n        that.treeMap.x(data.x + data.dx)\n        - that.treeMap.x(data.x)\n        - (2 * reduction)\n      ));\n\n      return data.cache.width;\n    })\n    .attr('height', function (data) {\n      data.cache.height = Math.max(0, (\n        that.treeMap.y(data.y + data.dy)\n        - that.treeMap.y(data.y)\n        - (2 * reduction)\n      ));\n\n      return data.cache.height;\n    });\n};\n\n/**\n * Remove all levels until `newLevel`.\n *\n * @method  removeLevelsOfNodes\n * @author  Fritz Lekschas\n * @date    2015-08-05\n * @param   {Number}  oldLevel  Former level of depth.\n */\nTreeMapCtrl.prototype.removeLevelsOfNodes = function (oldLevel) {\n    var i,\n      len,\n      startLevel = this.currentLevel + this.visibleDepth,\n      that = this;\n\n    // Add inner nodes to `.group-of-nodes` at `startLevel`.\n    for (i = 0, len = this.children[startLevel].length; i < len; i++) {\n      this.children[startLevel][i].each(function (data) {\n        that.fadeIn(that.addInnerNodes(that.d3.select(this)));\n      });\n    }\n\n    // Remove all children deeper than what is specified.\n    for (i = 0, len = this.children[startLevel + 1].length; i < len; i++) {\n      var group = this.children[startLevel + 1][i].transition().duration(250);\n\n      // Fade groups out and remove them\n      group\n        .style('opacity', 0)\n        .remove();\n    }\n    // Unset intemediate levels\n    for (i = startLevel + 1; i <= oldLevel; i++) {\n      this.children[i] = undefined;\n    }\n};\n\n/**\n * Set breadcrumb navigation from the current `node` to the root.\n *\n * @method  setBreadCrumb\n * @author  Fritz Lekschas\n * @date    2015-08-03\n * @param   {Object}  node  D3 data object.\n */\nTreeMapCtrl.prototype.setBreadCrumb = function (node) {\n  this.treeMap.grandParent.selectAll('li').remove();\n\n  var parent = node,\n      that = this;\n\n  if (!node.parent) {\n    this.treeMap.grandParent\n      .append('li')\n        .attr('class', 'inactive')\n        .text(node.name);\n  } else {\n    parent = node.parent;\n    while (parent) {\n      this.treeMap.grandParent\n        .insert('li', 'li:first-child')\n          .append('a')\n            .datum(parent)\n            .text(parent.name);\n\n      node = parent;\n      parent = node.parent;\n    }\n  }\n};\n\n/**\n * Transition between parent and child branches of the treemap.\n *\n * @method  transition\n * @author  Fritz Lekschas\n * @date    2015-08-03\n * @param   {Object}  data  D3 data object of the node to transition to.\n */\nTreeMapCtrl.prototype.transition = function (el, data) {\n  if (this.treeMap.transitioning || !data) {\n    return;\n  }\n\n  this.currentLevel = data.meta.depth;\n\n  this.treeMap.transitioning = true;\n\n  var newGroups = this.display.call(this, data),\n      newGroupsTrans, formerGroupWrapper, formerGroupWrapperTrans;\n\n  // After all newly added inner nodes and leafs have been faded in we call the\n  // zoom transition.\n  newGroups[1]\n    .then(function () {\n      // Fade in animations finished\n      newGroups = newGroups[0];\n      newGroupsTrans = newGroupsTrans = newGroups\n        .transition()\n        .duration(this.settings.treeMapZoomDuration);\n      formerGroupWrapper = this.treeMap.formerGroupWrapper;\n      formerGroupWrapperTrans = formerGroupWrapper\n        .transition()\n        .duration(this.settings.treeMapZoomDuration);\n\n      // Update the domain only after entering new elements.\n      this.treeMap.x.domain([data.x, data.x + data.dx]);\n      this.treeMap.y.domain([data.y, data.y + data.dy]);\n\n      // Enable anti-aliasing during the transition.\n      this.treeMap.element.style('shape-rendering', null);\n\n      // Fade-in entering text.\n      newGroups.selectAll('.label-wrapper')\n        .style('fill-opacity', 0);\n\n      formerGroupWrapperTrans.selectAll('.inner-border')\n        .call(this.rect.bind(this), 1);\n\n      formerGroupWrapperTrans.selectAll('.outer-border, .leaf')\n        .call(this.rect.bind(this));\n\n      formerGroupWrapperTrans.selectAll('.label-wrapper')\n        .call(this.rect.bind(this), 2);\n\n      newGroupsTrans.selectAll('.inner-border')\n        .call(this.rect.bind(this), 1);\n\n      newGroupsTrans.selectAll('.outer-border, .leaf')\n        .call(this.rect.bind(this));\n\n      newGroupsTrans.selectAll('.label-wrapper')\n        .style('fill-opacity', 1)\n        .call(this.rect.bind(this), 2);\n\n      // Remove the old node when the transition is finished.\n      formerGroupWrapperTrans.remove()\n        .each('end', function() {\n          this.treeMap.element.style('shape-rendering', 'crispEdges');\n          this.treeMap.transitioning = false;\n        }.bind(this));\n    }.bind(this))\n    .catch(function (e) {\n      console.error(e);\n    });\n};\n\n\n/*\n * -----------------------------------------------------------------------------\n * Properties\n * -----------------------------------------------------------------------------\n */\n\n/**\n * Holds all nodes per level.\n *\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @type    {Array}\n */\nObject.defineProperty(\n  TreeMapCtrl.prototype,\n  'children',\n  {\n    configurable: false,\n    enumerable: true,\n    value: [],\n    writable: true\n  }\n);\n\n/**\n * D3 data object.\n *\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @type    {Boolean}\n */\nObject.defineProperty(\n  TreeMapCtrl.prototype,\n  'data',\n  {\n    configurable: false,\n    enumerable: true,\n    value: {},\n    writable: true\n});\n\n/**\n * Depth of the pruned data tree.\n *\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @type    {Number}\n */\nObject.defineProperty(\n  TreeMapCtrl.prototype,\n  'depth',\n  {\n    configurable: false,\n    enumerable: true,\n    value: 0,\n    writable: true\n});\n\n/**\n * Number of visible levels below the current level.\n *\n * @author  Fritz Lekschas\n * @date    2015-08-04\n * @type    {Number}\n */\nObject.defineProperty(\n  TreeMapCtrl.prototype,\n  'visibleDepth',\n  {\n    configurable: false,\n    enumerable: true,\n    get: function () {\n      return this._visibleDepth;\n    },\n    set: function (visibleDepth) {\n      var oldLevel = this._visibleDepth;\n      this._visibleDepth = Math.min(Math.max(1, visibleDepth), this.depth);\n      this.adjustLevelDepth(oldLevel, this.visibleDepth);\n    }\n});\n\n/**\n * Object holding the actual D3 treemap and related data.\n *\n * @type  {Object}\n */\nObject.defineProperty(\n  TreeMapCtrl.prototype,\n  'treeMap',\n  {\n    configurable: false,\n    enumerable: true,\n    value: {},\n    writable: true\n});\n\nangular\n  .module('treeMap')\n  .controller('TreeMapCtrl', [\n    '$element',\n    '$q',\n    '$',\n    'd3',\n    'neo4jD3',\n    'HEX',\n    'D3Colors',\n    'settings',\n    TreeMapCtrl\n  ]);\n","function treeMapDirective () {\n  'use strict';\n\n  return {\n    controller: 'TreeMapCtrl',\n    controllerAs: 'treeMap',\n    restrict: 'E',\n    replace: true,\n    templateUrl: 'treeMap/template.html'\n  };\n}\n\nangular\n  .module('treeMap')\n  .directive('treeMap', [\n    treeMapDirective\n  ]);\n","/* global angular:false */\n\nfunction TreeMapDivCtrl ($window, $element, $, d3, neo4jD3, D3Colors) {\n  this.$window = $window;\n  this.$ = $;\n  this.d3 = d3;\n  this.$element = this.$($element),\n  this.$d3Element = this.$element.find('.treeMap');\n\n  /**\n   * Current level of depth. By default starting at the root, e.g. zero.\n   *\n   * @type  {Number}\n   */\n  this.currentDepth = 0;\n\n  this._visibleDepth = 3;\n\n  this.treeMap.width = this.$d3Element.width();\n  this.treeMap.height = this.$d3Element.height();\n\n  this.numColors = 10;\n  this.steps = 6;\n\n  this.treeMap.colors = new D3Colors(\n    this.d3.scale.category10().domain(d3.range(this.numColors)).range()\n  ).getScaledFadedColors(this.steps);\n\n  this.treeMap.x = this.d3.scale.linear()\n    .domain([0, this.treeMap.width])\n    .range([0, this.treeMap.width]);\n\n  this.treeMap.y = this.d3.scale.linear()\n    .domain([0, this.treeMap.height])\n    .range([0, this.treeMap.height]);\n\n  this.treeMap.el = this.d3.layout.treemap()\n    .children(function(d, depth) { return depth ? null : d._children; })\n    .sort(function(a, b) { return a.value - b.value; })\n    .ratio(this.treeMap.height / this.treeMap.width * 0.5 * (1 + Math.sqrt(5)))\n    .round(false);\n\n  this.treeMap.element = this.d3.select(this.$d3Element[0]).append('div')\n    .classed('wrapper', true);\n\n  this.treeMap.$element = $(this.treeMap.element[0]);\n\n  this.treeMap.grandparent = this.d3.select('#back');\n\n  neo4jD3.d3\n    .then(function (data) {\n      this.data = data;\n      this.draw();\n    }.bind(this));\n}\n\n/*\n * -----------------------------------------------------------------------------\n * Methods\n * -----------------------------------------------------------------------------\n */\n\n/**\n * Starter function for aggrgation and pruning.\n *\n * @param  {Object} data       D3 data object.\n * @param  {String} valueProp  Name of the property holding the value.\n */\nTreeMapDivCtrl.prototype.accumulateAndPrune = function (data, valueProp) {\n  var numChildren = data.children ? data.children.length : false;\n  data.meta = data.meta || {};\n\n  if (numChildren) {\n    accumulateAndPruneChildren.call(this, data, numChildren, valueProp, 0);\n    if (data.value) {\n      data.value += data[valueProp];\n    } else {\n      data.value = data[valueProp];\n    }\n  }\n\n  /**\n   * Recursively accumulate `valueProp` values and prune _empty_ leafs.\n   *\n   * This function traverses all inner loops and stops one level BEFORE a leaf\n   * to be able to splice (delete) empty leafs from the list of children\n   *\n   * @param  {Object}   node         D3 data object of the node.\n   * @param  {Number}   numChildren  Number of children of `node.\n   * @param  {String}   valueProp    Property name of the propery holding the value of the node's _size_.\n   * @param  {Number}   depth        Original depth of the current node.\n   * @param  {Boolean}  root         If node is the root.\n   */\n  function accumulateAndPruneChildren (node, numChildren, valueProp, depth) {\n    // A reference for later\n    node._children = node.children;\n    node.meta.originalDepth = depth;\n    var i = numChildren;\n    // We move in reverse order so that deleting nodes doesn't affect future\n    // indices.\n    while (i--) {\n      var child = node.children[i];\n      var numChildChildren = child.children ? child.children.length : false;\n\n      child.meta = child.meta || {};\n\n      if (numChildChildren) {\n        // Inner node.\n        accumulateAndPruneChildren.call(\n          this, child, numChildChildren, valueProp, depth + 1\n        );\n        numChildChildren = child.children.length;\n      }\n\n      // We check again the number of children of the child since it can happen\n      // that all children have been deleted meanwhile and the inner node became\n      // a leaf as well.\n      if (numChildChildren) {\n        // Inner node.\n        if (child[valueProp]) {\n          // Add own `numDataSets` to existing `value`.\n          child.value += child[valueProp];\n          // To represent this node visually in the tree map we need to create\n          // a \"fake\" child, i.e. pseudo node, holding the values of this inner\n          // node.\n          child.children.push({\n            name: child.name,\n            meta: {\n              originalDepth: child.depth + 1,\n              pseudoNode: true\n            },\n            value: child[valueProp]\n          });\n          child.children[child.children.length - 1][valueProp] = child[valueProp];\n        } else {\n          // We prune `child`, i.e. remove, a node in two cases\n          // A) `child` is the only child of `node` or\n          // B) `child` only has one child.\n          // This way we ensure that the out degree of `child` is two or higher.\n          if (numChildren === 1 || numChildChildren === 1) {\n            // We can remove the inner node since it wasn't used for any\n            // annotations.\n            for (var j = 0, len = child.children.length; j < len; j++) {\n              if (child.children[j].meta.skipped) {\n                child.children[j].meta.skipped.unshift(child.name);\n              } else {\n                child.children[j].meta.skipped = [child.name];\n              }\n              node.children.push(child.children[j]);\n            }\n            // Remove the child with the empty valueProp\n            node.children.splice(i, 1);\n          }\n        }\n      } else {\n        // Leaf.\n        if (!child[valueProp]) {\n          // Leaf was not used for annotation so we remove it.\n          node.children.splice(i, 1);\n          numChildren--;\n          continue;\n        } else {\n          // Set `value` of the leaf itself.\n          child.value = child[valueProp];\n          child.meta.leaf = true;\n          child.meta.originalDepth = depth + 1;\n        }\n      }\n\n      // Increase `value` if the node by the children's `numDataSets`.\n      if (typeof node.value !== 'undefined') {\n        node.value += child.value;\n      } else {\n        node.value = child.value;\n      }\n    }\n  }\n};\n\n\n/**\n * Recursively add nodes level by level.\n *\n * @method  addChildren\n * @author  Fritz Lekschas\n * @date    2015-08-01\n * @param   {[type]}     parent  [description]\n * @param   {[type]}     data    [description]\n * @param   {[type]}     level   [description]\n */\nTreeMapDivCtrl.prototype.addChildren = function (\n  parent, data, level, firstTime) {\n  var that = this;\n\n  // Create nodes\n  var nodes = parent.selectAll('div')\n    .data(data._children)\n    .enter()\n      .append('div')\n      .attr('class', function (node) {\n        var classes = 'node';\n        if (node._children && node._children.length) {\n          classes += ' inner-node';\n        } else {\n          classes += ' leaf';\n          node.visibility = true;\n        }\n        if (level == this.visibleDepth) {\n          classes += ' last';\n          node.visibility = true;\n        }\n        // Hide nodes if they are deeper than the specified `depth`\n        if (level > this.visibleDepth) {\n          classes += ' hidden';\n        }\n        return classes;\n      }.bind(this))\n      .attr('title', function (node) {\n        return node.uri;\n      })\n      .style('background-color', function (node) {\n        if (node.visibility) {\n          return this.color(node);\n        }\n      }.bind(this))\n      .call(that.coordinates.bind(that));\n\n  // Add name to nodes\n  nodes.append('span')\n    .attr('class', function (node) {\n      var classes = 'name';\n      if (node.meta.aspectRatio < 1) {\n        classes += ' rotated';\n      }\n      return classes;\n    })\n    .text(function(node) { return node.name; });\n\n  this.nodesAtLevel[level + 1] = this.nodesAtLevel[level + 1] || [];\n\n  nodes.each(function (node) {\n\n    if (firstTime && node.visibility) {\n      var $el = $(this);\n\n      $el\n        .css({\n          'opacity': 0,\n          'transform': 'scale(0.9)'\n        });\n\n      that.$window.requestNextAnimationFrame(function() {\n        $el\n          .css('transitionDuration', function () {\n            return ((500 + parseInt(Math.random() * 750)) / 1000) + 's';\n          })\n          .css('transitionDelay', function () {\n            return (parseInt(Math.random() * 500) / 1000) + 's';\n          })\n          .css({\n            'opacity': 1,\n            'transform': 'scale(1)'\n          });\n      });\n    }\n\n    if (node._children && node._children.length) {\n      // Recursion\n      that.nodesAtLevel[level + 1].push(\n        that.addChildren(that.d3.select(this), node, level + 1, firstTime)\n      );\n    }\n  });\n\n  return nodes;\n};\n\nTreeMapDivCtrl.prototype.addClickListener = function () {\n  var that = this;\n\n  $(this.treeMap.element[0]).on('click', '.inner-node.last', function (event) {\n    // D3 hard links data with DOM elements and stores it under the `__data__`\n    // property.\n    that.transition(this, this.__data__);\n  });\n};\n\nTreeMapDivCtrl.prototype.adjustLevelDepth = function (oldLevel, newLevel) {\n  if (oldLevel === newLevel) {\n    return;\n  }\n\n  var from, to, i, j, hidden;\n\n  if (oldLevel < newLevel) {\n    from = oldLevel - 1;\n    to = newLevel;\n  } else {\n    // Remove all children deeper than what is specified.\n    hidden = true;\n    from = newLevel - 1;\n    to = oldLevel;\n  }\n\n  for (i = 0, len = this.nodesAtLevel[newLevel].length; i < len; i++) {\n    // Show nodes at current level\n    this.nodesAtLevel[newLevel][i]\n      .classed('last', true)\n      .classed('hidden', false);\n  }\n\n  for (i = 0, len = this.nodesAtLevel[oldLevel].length; i < len; i++) {\n    // Hide nodes at former level\n    this.nodesAtLevel[oldLevel][i]\n      .classed('last', false)\n      .classed('hidden', true);\n  }\n\n\n  // `from` and `to` are included in the loop.\n  while (from++ < to) {\n    for (i = 0, len = this.nodesAtLevel[from].length; i < len; i++) {\n      this.nodesAtLevel[from][i]\n        .style('background-color', function (node) {\n          if (from === newLevel || node.meta.revDepth === 0) {\n            return this.color(node);\n          }\n        }.bind(this))\n        .classed('last', function (node) {\n          if (from === newLevel) {\n            return true;\n          }\n        })\n        .classed('hidden', function (node) {\n          if (hidden && from === newLevel) {\n            return false;\n          }\n          return hidden;\n        });\n    }\n  }\n};\n\n/**\n * Set the browsing mode.\n *\n * @param  {String}  mode  Name of the mode.\n */\nTreeMapDivCtrl.prototype.browseMode = function (mode) {\n  this.mode = mode;\n};\n\n/**\n * Generate a color given an elements node data object.\n *\n * @method  color\n * @author  Fritz Lekschas\n * @date    2015-07-31\n * @param   {Object}  node  D3 node data object.\n * @return  {String}        HEX color string.\n */\nTreeMapDivCtrl.prototype.color = function (node) {\n  if (this.colorMode === 'depth') {\n    // Color by original depth\n    // The deeper the node, the lighter the color\n    return this.treeMap.colors((node.meta.branchNo[0] * this.steps) +\n      Math.min(this.steps, node.meta.originalDepth) - 1);\n  }\n  // Default:\n  // Color by reverse final depth, i.e. after pruning. The fewer children a node\n  // has, the lighter the color. E.g. a leaf is lightest while the root is\n  // darkest.\n  return this.treeMap.colors((node.meta.branchNo[0] * this.steps) +\n    Math.max(0, this.steps - node.meta.revDepth - 1));\n}\n\n/**\n * Provide a color to a DOM's attribute\n *\n * @method  colorEl\n * @author  Fritz Lekschas\n * @date    2015-07-31\n * @param   {Object}    element    DOM element created by D3.\n * @param   {String}    attribute  Name of attribute that should be colored.\n */\nTreeMapDivCtrl.prototype.colorEl = function (element, attribute) {\n  element\n    .attr(attribute, this.color.bind(this));\n};\n\n/**\n * Display the data.\n *\n * @param   {Object}  node  D3 data object of the node.\n * @return  {Object}        D3 selection of node's children.\n */\nTreeMapDivCtrl.prototype.display = function (node, firstTime) {\n  var that = this;\n\n  // Update the grand parent, which is kind of the \"back button\"\n  this.treeMap.grandparent\n    .datum(node.parent)\n    .on(\"click\", function (data) {\n      /*\n       * that = TreeMapDivCtrl\n       * this = the clicked DOM element\n       * data = data\n       */\n      that.transition.call(that, this, data);\n    })\n    .text(this.name(node));\n\n  this.treeMap.element\n    .datum(node);\n\n  // For completeness we store the children of level zero.\n  this.nodesAtLevel[0] = [this.treeMap.element];\n\n  var children = this.addChildren.call(\n    this, this.treeMap.element, node, 1, firstTime);\n\n  // We have to cache the children to dynamically adjust the level depth.\n  this.nodesAtLevel[1] = [children];\n\n  return children;\n};\n\n/**\n * Draw the treemap.\n */\nTreeMapDivCtrl.prototype.draw = function () {\n  if (this.data === null) {\n    return false;\n  }\n\n  console.log('vdepth ' + this.visibleDepth);\n\n  this.initialize(this.data);\n  this.accumulateAndPrune(this.data, 'numDataSets');\n  this.layout(this.data, 0);\n  this.display(this.data, true);\n  this.addClickListener();\n};\n\n/**\n * Initialize the root node. This would usually be computed by `treemap()`.\n *\n * @param  {Object} data  D3 data object.\n */\nTreeMapDivCtrl.prototype.initialize = function (data) {\n  data.x = data.y = 0;\n  data.dx = this.treeMap.width;\n  data.dy = this.treeMap.height;\n  data.depth = 0;\n  data.meta = {\n    branchNo: []\n  };\n};\n\n/**\n * Recursively compute the layout of each node depended on its parent.\n *\n * Compute the treemap layout recursively such that each group of siblings uses\n * the same size (11) rather than the dimensions of the parent cell. This\n * optimizes the layout for the current zoom state. Note that a wrapper object\n * is created for the parent node for each group of siblings so that the\n * parent's dimensions are not discarded as we recurse. Since each group of\n * sibling was laid out in 11, we must rescale to fit using absolute\n * coordinates. This lets us use a viewport to zoom.\n *\n * @param  {Object}  data  D3 data object.\n */\nTreeMapDivCtrl.prototype.layout = function (parent, depth) {\n  parent.meta.depth = depth;\n  if (parent._children && parent._children.length) {\n    this.treeMap.depth = Math.max(this.treeMap.depth, depth + 1);\n    // This creates an anonymous 1px x 1px treemap and sets the children's\n    // coordinates accordingly.\n    this.treeMap.el({_children: parent._children});\n    for (var i = 0, len = parent._children.length; i < len; i++) {\n      var child = parent._children[i];\n      child.x = child.x * parent.dx;\n      child.y = child.y * parent.dy;\n      child.dx *= parent.dx;\n      child.dy *= parent.dy;\n      child.parent = parent;\n\n      // Store aspect ration and area for later font styling\n      child.meta.aspectRatio = child.dx / child.dy;\n      child.meta.area = child.dy * child.dx;\n\n      // Keep a reference of the branches that have been taken\n      child.meta.branchNo = parent.meta.branchNo.concat([i]);\n\n      // Recursion\n      this.layout(child, depth + 1);\n\n      // Take the max reverse depth when we visite the inner node the second\n      // time.\n      parent.meta.revDepth = Math.max(\n        child.meta.revDepth + 1,\n        parent.meta.revDepth || 0\n      )\n    }\n  } else {\n    // Leaf\n    // Leafs have a reverse depth of zero.\n    parent.meta.revDepth = 0;\n  }\n};\n\n/**\n * Generate the name of the node.\n *\n * @param   {Object}  data  Node's D3 data object.\n * @return  {String}        Name of the node.\n */\nTreeMapDivCtrl.prototype.name = function (data) {\n    return data.parent ? this.name(data.parent) + \".\" + data.name : data.name;\n};\n/**\n * Set the coordinates of the rectangular.\n *\n * How to invoke:\n * `d3.selectAll('rect').call(this.rect.bind(this))`\n *\n * Note: This weird looking double this is needed as the context of a `call`\n * function is actually the same as the selection passed to it, which seems\n * redundant but that's how it works right now. So to assign `TreeMapDivCtrl` as\n * the context we have to manually bind `this`.\n *\n * URL: https://github.com/mbostock/d3/wiki/Selections#call\n *\n * @param  {Array}  elements  D3 selection of DOM elements.\n */\nTreeMapDivCtrl.prototype.coordinates = function (elements) {\n  var that = this;\n\n  elements\n    .style('left', function (data) {\n      return that.treeMap.x(data.x) + 'px';\n    })\n    .style('top', function (data) {\n      return that.treeMap.y(data.y) + 'px';\n    })\n    .style('width', function (data) {\n      return (that.treeMap.x(data.x + data.dx) - that.treeMap.x(data.x)) + 'px';\n    })\n    .style('height', function (data) {\n      return (that.treeMap.y(data.y + data.dy) - that.treeMap.y(data.y)) + 'px';\n    });\n};\n\n/**\n * Transition between parent <> child branches of the treemap.\n *\n * @param   {Object}  data  D3 data object of the node to transition to.\n */\nTreeMapDivCtrl.prototype.transition = function (el, data) {\n  if (this.treeMap.transitioning || !data) {\n    return;\n  }\n\n  this.treeMap.transitioning = true;\n\n  var absX = 0, absY = 0, node = data;\n  while (node.meta.depth > this.currentDepth) {\n    absX += node.x;\n    absY += node.y;\n    node = node.parent;\n  }\n\n  // We need to delay the zoom transition to allow the fade-in transition of\n  // to fully end. This is solution is not ideal but chaining transitions like\n  // described at http://stackoverflow.com/a/17101823/981933 is infeasable\n  // since an unknown number of multiple selections has to be transitioned first\n  var transition = this.treeMap.element.transition().duration(750);\n\n  // Update the domain only after entering new elements.\n  this.treeMap.x.domain([0, data.dx]);\n  this.treeMap.y.domain([0, data.dy]);\n\n  var scaleX = this.treeMap.width / data.dx,\n      scaleY = this.treeMap.height / data.dy,\n      originX = absX + (data.dx / 2),\n      originY = absY + (data.dy / 2),\n      centerAdjustmentX = (this.treeMap.width / 2) - originX,\n      centerAdjustmentY = (this.treeMap.height / 2) - originY;\n\n  console.log(\n    'transform-origin: ' + (absX + (data.dx / 2)) + 'px ' + (absY + (data.dy / 2)) + 'px', 'scaleX(' + scaleX +') scaleY(' + scaleY +')',\n    centerAdjustmentX,\n    centerAdjustmentY,\n    'translate3d(-' + absX + 'px, -' + absY + 'px)'\n  );\n\n  this.treeMap.$element\n    .css('transform', 'translate3d(-' + (absX * scaleX) + 'px, -' + (absY * scaleY) + 'px, 0)');\n\n  // this.treeMap.$element\n  //   .css({\n  //     'transformOrigin': originX + 'px ' + originY + 'px',\n  //     'transform': 'translate(' + centerAdjustmentX + 'px, ' + centerAdjustmentY + 'px) scaleX(' + scaleX +') scaleY(' + scaleY +')'\n  //   });\n\n  this.treeMap.element.selectAll('.node')\n    .style('transition-delay', null)\n    .style('transition-duration', null)\n    .style('transform', 'rotate(0.1deg)')\n    .call(this.coordinates.bind(this));\n};\n\n\n/*\n * -----------------------------------------------------------------------------\n * Properties\n * -----------------------------------------------------------------------------\n */\n\nObject.defineProperty(\n  TreeMapDivCtrl.prototype,\n  'nodesAtLevel',\n  {\n    configurable: false,\n    enumerable: true,\n    value: [],\n    writable: true\n  }\n);\n\nObject.defineProperty(\n  TreeMapDivCtrl.prototype,\n  'data',\n  {\n    configurable: false,\n    enumerable: true,\n    value: null,\n    writable: true\n});\n\nObject.defineProperty(\n  TreeMapDivCtrl.prototype,\n  'mode',\n  {\n    configurable: false,\n    enumerable: true,\n    value: 'branch',\n    writable: true\n});\n\nObject.defineProperty(\n  TreeMapDivCtrl.prototype,\n  'visibleDepth',\n  {\n    configurable: false,\n    enumerable: true,\n    get: function () {\n      return this._visibleDepth;\n    },\n    set: function (visibleDepth) {\n      var oldLevel = this._visibleDepth;\n      this._visibleDepth = Math.max(1, visibleDepth);\n      this.adjustLevelDepth(oldLevel, this.visibleDepth);\n    }\n});\n\nObject.defineProperty(\n  TreeMapDivCtrl.prototype,\n  'treeMap',\n  {\n    configurable: false,\n    enumerable: true,\n    value: {},\n    writable: true\n});\n\nangular\n  .module('treeMapDiv')\n  .controller('TreeMapDivCtrl', [\n    '$window',\n    '$element',\n    '$',\n    'd3',\n    'neo4jD3',\n    'D3Colors',\n    TreeMapDivCtrl\n  ]);\n","function treeMapDivDirective () {\n  'use strict';\n\n  return {\n    controller: 'TreeMapDivCtrl',\n    controllerAs: 'treeMap',\n    restrict: 'E',\n    replace: true,\n    templateUrl: 'treeMapDiv/template.html'\n  };\n}\n\nangular\n  .module('treeMapDiv')\n  .directive('treeMapDiv', [\n    treeMapDivDirective\n  ]);\n","function Neo4J ($resource, $window) {\n  return function (url, user, password) {\n    return $resource(\n      url + '/db/data/transaction/commit/',\n      {},\n      {\n        query: {\n          method: 'POST',\n          headers: {\n            'Accept': 'application/json; charset=UTF-8',\n            'Content-type': 'application/json',\n            // Base64 encoding using `window.btoa`\n            'Authorization': 'Basic: ' + $window.btoa(user + ':' + password)\n          },\n          isArray: false,\n        }\n      }\n    );\n  };\n}\n\nangular\n  .module('neo4jD3')\n  .factory('Neo4J', [\n    '$resource',\n    '$window',\n    Neo4J\n  ]);\n","function buildTree (results) {\n  var child,\n      // Stores the children of each node..\n      // The only difference to `nodes` is that the `children` is an object\n      // holding the name of the child node.\n      childIndex = {\n        'owl:Thing': {}\n      },\n      currentChild,\n      currentDataSet,\n      currentParent,\n      data = results.data,\n      dataSet,\n      i,\n      lastNode,\n      len,\n      nodes = {\n        'owl:Thing': {\n          // Fortunately `owl:Thing` the mandatory root for any ontology.\n          name: 'owl:Thing',\n          children: []\n        }\n      },\n      parent;\n\n  // Determine which column corresponce to which node\n  len = results.columns.length;\n  for (i = 0; i < len; i++) {\n    switch (results.columns[i]) {\n      case 'child':\n        child = i;\n        break;\n      case 'dataSet':\n        dataSet = i;\n        break;\n      case 'parent':\n        parent = i;\n        break;\n    }\n  }\n\n  // Loop over all rows and build the tree\n  len = data.length;\n  for (i = 0; i < len; i++) {\n    // Cache for speed:\n    // Extensive object nesting is expensive;\n    currentChild = data[i].row[child];\n    currentDataSet = data[i].row[dataSet];\n    currentParent = data[i].row[parent];\n\n    if (!(currentParent.name in nodes)) {\n      nodes[currentParent.name] = {\n        children: [],\n        dataSets: [],\n        name: currentParent.name,\n        numDataSets: 0,\n        ontID: currentParent.name\n      };\n    }\n\n    if (!(currentChild.name in nodes)) {\n      nodes[currentChild.name] = {\n        children: [],\n        dataSets: [],\n        name: currentChild.name,\n        numDataSets: 0,\n        ontID: currentChild.name\n      };\n    }\n\n    if ('rdfs:label' in currentChild) {\n      nodes[currentChild.name].name = currentChild['rdfs:label'];\n    }\n\n    if ('uri' in currentChild) {\n      nodes[currentChild.name].uri = currentChild.uri;\n    }\n\n    if (currentDataSet !== null) {\n      nodes[currentChild.name].numDataSets++;\n      nodes[currentChild.name].dataSets.push(currentDataSet.uuid);\n    }\n\n    if (!(currentParent.name in childIndex)) {\n      childIndex[currentParent.name] = {};\n    }\n\n    if (!(currentChild.name in childIndex[currentParent.name])) {\n      nodes[currentParent.name].children.push(nodes[currentChild.name]);\n      childIndex[currentParent.name][currentChild.name] = true;\n    }\n  }\n\n  // Deep clone object to be usable by D3\n  return JSON.parse(JSON.stringify(nodes['owl:Thing']));\n}\n\nfunction Neo4jD3 ($q, Neo4J, settings) {\n  // Private\n  var d3Deferred = $q.defer();\n\n  this.Neo4J = new Neo4J(\n    settings.neo4jUrl,\n    settings.neo4jUser,\n    settings.neo4jPassword\n  );\n\n  this.Neo4J.query({\n      statements: [{\n        statement: \"MATCH (parent:cl:Class)<-[:`rdfs:subClassOf`]-(child) \" +\n          \"OPTIONAL MATCH (dataSet:DataSet)-[:`annotated_with`]->(child) \" +\n          \"RETURN parent, child, dataSet\"\n      }]\n    })\n    .$promise\n    .then(function (response) {\n      if (response.errors.length === 0) {\n        try {\n          var start = new Date().getTime();\n          var d3Data = buildTree(response.results[0]);\n          d3Deferred.resolve(d3Data);\n          var end = new Date().getTime();\n          var time = end - start;\n          console.log('Neo4J to D3 converter execution time: ' + time);\n        } catch (error) {\n          d3Deferred.reject(error);\n          console.error(error);\n        }\n      }\n      this.neo4jResponse = response;\n    }.bind(this))\n    .catch(function (error) {\n      d3Deferred.reject(error);\n      console.error(error);\n    });\n\n  this.d3 = d3Deferred.promise;\n}\n\nObject.defineProperty(\n  Neo4jD3.prototype,\n  'neo4jResponse', {\n    configurable: false,\n    enumerable: true,\n    writable: true\n});\n\nObject.defineProperty(\n  Neo4jD3.prototype,\n  'd3', {\n    configurable: false,\n    enumerable: true,\n    writable: true\n});\n\nangular\n  .module('neo4jD3')\n  .service('neo4jD3', [\n    '$q',\n    'Neo4J',\n    'settings',\n    Neo4jD3\n  ]);\n","angular\n  .module('treeMapApp', [\n    'templates',\n    'treeMap',\n    'treeMapDiv',\n    'globalEvents'\n  ]);\n","angular\n  .module('treeMap', [\n    'neo4jD3',\n    'd3Colors'\n  ]);\n","angular\n  .module('treeMapDiv', [\n    'neo4jD3',\n    'd3Colors'\n  ]);\n","angular\n  .module('color', []);\n","angular\n  .module('globalEvents', []);\n","angular\n  .module('neo4jD3', [\n    'ngResource'\n  ]);\n","angular\n  .module('treeMapApp')\n  .config([function () {}]);\n","angular\n  .module('treeMapApp')\n  .constant('$', jQuery)\n  .constant('_', _.noConflict())\n  .constant('d3', d3);\n","angular\n  .module('treeMapApp')\n  .constant('settings', {\n    'neo4jUrl': 'http://localhost:7474',\n    'neo4jUser': 'neo4j',\n    'neo4jPassword': '123',\n    'treeMapFadeInDuration': 333,\n    'treeMapZoomDuration': 666\n  });\n","angular\n  .module('color')\n  .factory('HEX', ['$injector', function ($injector) {\n    /**\n     * HEX constructor object\n     *\n     * @param   String  hex    The hex color string.\n     */\n    function HEX (hex) {\n      this.hex = hex;\n    }\n\n    /**\n     * Assign constructor to itself\n     *\n     * @type {Function}\n     */\n    HEX.prototype.constructor = HEX;\n\n    /**\n     * Convert HEX to RGB and then to HSL.\n     *\n     * @return  {Object}  HSL object.\n     */\n    HEX.prototype.toHsl = function () {\n      return this.toRgb().toHsl();\n    };\n\n    /**\n     * Convert HEX to RGB.\n     *\n     * @return  {Object}  RGB object.\n     */\n    HEX.prototype.toRgb = function () {\n      var RGB = $injector.get('RGB'),\n          result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(this.hex);\n\n      return new RGB(\n        parseInt(result[1], 16),\n        parseInt(result[2], 16),\n        parseInt(result[3], 16)\n      );\n    };\n\n    /**\n     * Convert HEX to String with a prepended hash\n     *\n     * @return  {String}  String represenation of HEX.\n     */\n    HEX.prototype.toString = function () {\n      return '#' + this.hex;\n    };\n\n    Object.defineProperty(HEX.prototype, 'hex', {\n      get: function() {\n        return this._hex;\n      },\n      set: function(hex) {\n        if (typeof hex === 'string') {\n          var match = hex.match(/^#?((?:[0-9a-fA-F]{3}){1,2})$/i);\n          if (!match) {\n            throw new Error('String \"' + hex + '\" is not a valid HEX color.');\n          }\n          hex = match[1];\n        } else {\n          throw new Error('HEX must be a string. ' + typeof hex);\n        }\n        this._hex = hex;\n      }\n    });\n\n    return HEX;\n  }]);\n","angular\n  .module('color')\n  .factory('HSL', ['$injector', function ($injector) {\n    /**\n     * HSL constructor object\n     *\n     * @param   String  HSL    The HSL color string.\n     */\n    function HSL (hue, saturation, lightness) {\n      if (typeof hue === 'object') {\n        this.lightness = hue.lightness;\n        this.saturation = hue.saturation;\n        this.hue = hue.hue;\n      } else {\n        this.hue = hue;\n        this.lightness = lightness;\n        this.saturation = saturation;\n      }\n    }\n\n    /**\n     * Assign constructor to itself\n     *\n     * @type {Function}\n     */\n    HSL.prototype.constructor = HSL;\n\n    /**\n     * Brighten the color by step-wise increase of lightness. If `noLast` is `true`\n     * the number of steps doesn't include the final white.\n     *\n     * @param   {Number}   steps   Number of steps.\n     * @param   {Boolean}  noLast  Skip last step, i.e. white.\n     * @return  {Array}            Array of adjusted HSL colors.\n     */\n    HSL.prototype.brighten = function (steps, noLast) {\n      var colors = [],\n          i = 0,\n          lStep = (1 - this.lightness) / (steps + (noLast ? 1 : 0));\n\n      while (i++ < steps) {\n        colors.push(new HSL(\n          this.hue,\n          this.saturation,\n          this.lightness + (i * lStep)\n        ));\n      }\n\n      return colors;\n    };\n\n    /**\n     * Convert HEX to RGB and then to HSL.\n     *\n     * @return  {Object}  HSL object.\n     */\n    HSL.prototype.toHex = function () {\n      return this.toRgb().toHex();\n    };\n\n    /**\n     * Converts an HSL color value to RGB. Conversion formula\n     * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\n     * Assumes h, s, and l are contained in the set [0, 1] and\n     * returns r, g, and b in the set [0, 255].\n     *\n     * @return  {Array}  The RGB representation\n     */\n    HSL.prototype.toRgb = function () {\n      var RGB = $injector.get('RGB'),\n          r, g, b;\n\n      function hueToRgb (p, q, t) {\n        if (t < 0) {\n          t++;\n        }\n        if (t > 1) {\n          t--;\n        }\n        if (t < 1/6) {\n          return p + (q - p) * 6 * t;\n        }\n        if (t < 1/2) {\n          return q;\n        }\n        if (t < 2/3) {\n          return p + (q - p) * (2/3 - t) * 6;\n        }\n        return p;\n      }\n\n      if (this.saturation === 0) {\n        r = g = b = this.lightness; // achromatic\n      } else {\n        var q = this.lightness < 0.5 ? this.lightness * (1 + this.saturation) : this.lightness + this.saturation - this.lightness * this.saturation;\n        var p = 2 * this.lightness - q;\n\n        r = hueToRgb(p, q, this.hue + 1/3);\n        g = hueToRgb(p, q, this.hue);\n        b = hueToRgb(p, q, this.hue - 1/3);\n      }\n\n      return new RGB(\n        Math.round(r * 255),\n        Math.round(g * 255),\n        Math.round(b * 255)\n      );\n    };\n\n    Object.defineProperty(HSL.prototype, 'hue', {\n      get: function() {\n        return this._hue;\n      },\n      set: function(hue) {\n        if (!(typeof hue === 'number' && hue >= 0 && hue <= 1)) {\n          throw new Error('Hue must be a float between 0 and 1.');\n        }\n        this._hue = hue;\n      }\n    });\n\n    Object.defineProperty(HSL.prototype, 'lightness', {\n      get: function() {\n        return this._lightness;\n      },\n      set: function(lightness) {\n        if (!(typeof lightness === 'number' && lightness >= 0 && lightness <= 1)) {\n          throw new Error('Lightness must be a float between 0 and 1.');\n        }\n        this._lightness = lightness;\n      }\n    });\n\n    Object.defineProperty(HSL.prototype, 'saturation', {\n      get: function() {\n        return this._saturation;\n      },\n      set: function(saturation) {\n        if (!(typeof saturation === 'number' && saturation >= 0 && saturation <= 1)) {\n          throw new Error('Saturation must be a float between 0 and 1.');\n        }\n        this._saturation = saturation;\n      }\n    });\n\n    return HSL;\n  }]);\n","angular\n  .module('color')\n  .service('RGB', ['$injector', function ($injector) {\n    /**\n     * RGB constructor object\n     *\n     * @param   Number  red    The red color value.\n     * @param   Number  green  The green color value.\n     * @param   Number  blue   The blue color value.\n     */\n    function RGB (red, green, blue) {\n      if (typeof red === 'object') {\n        this.blue = red.blue;\n        this.green = red.green;\n        this.red = red.red;\n      } else {\n        this.blue = blue;\n        this.green = green;\n        this.red = red;\n      }\n    }\n\n    /**\n     * Assign constructor to itself\n     *\n     * @type {Function}\n     */\n    RGB.prototype.constructor = RGB;\n\n    /**\n     * Converts the RGB color value to HSL. Conversion formula\n     * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\n     * Assumes r, g, and b are contained in the set [0, 255] and\n     * returns h, s, and l in the set [0, 1].\n     *\n     * @param   Number  r  The red color value.\n     * @param   Number  g  The green color value.\n     * @param   Number  b  The blue color value.\n     * @return  Array      The HSL representation.\n     */\n    RGB.prototype.toHsl = function () {\n      var r = this.red / 255,\n          g = this.green / 255,\n          b = this.blue / 255,\n          max = Math.max(r, g, b),\n          min = Math.min(r, g, b),\n          h,\n          s,\n          l = (max + min) / 2,\n          HSL = $injector.get('HSL');\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      } else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return new HSL(\n        h,\n        s,\n        l\n      );\n    };\n\n    /**\n     * Converts the RGB color value to HEX.\n     *\n     * @param   Number  r  The red color value.\n     * @param   Number  g  The green color value.\n     * @param   Number  b  The blue color value.\n     * @return  String     The HEX representation.\n     */\n    RGB.prototype.toHex = function () {\n      var HEX = $injector.get('HEX');\n\n      return new HEX(\n        '#' + ((1 << 24) + (this.red << 16) + (this.green << 8) + this.blue).toString(16).slice(1)\n      );\n    };\n\n    RGB.prototype.luminosity = function (red, green, blue) {\n      // http://www.w3.org/TR/WCAG20/#relativeluminancedef\n      if (typeof red === 'undefined') {\n        red = this.red;\n        green = this.green;\n        blue = this.blue;\n      }\n\n      function lum (absValue) {\n        var relValue = absValue / 255;\n        return relValue <= 0.03928 ?\n          relValue / 12.92 : Math.pow(((relValue + 0.055) / 1.055), 2.4);\n      }\n\n      return 0.2126 * lum(red) + 0.7152 * lum(green) + 0.0722 * lum(blue);\n    };\n\n    RGB.prototype.contrast = function (color) {\n      // http://www.w3.org/TR/WCAG20/#contrast-ratiodef\n      var lum1 = this.luminosity(this.red, this.green, this.blue);\n      var lum2 = this.luminosity(color.red, color.green, color.blue);\n      if (lum1 > lum2) {\n         return (lum1 + 0.05) / (lum2 + 0.05)\n      };\n      return (lum2 + 0.05) / (lum1 + 0.05);\n    };\n\n    Object.defineProperty(RGB.prototype, 'blue', {\n      get: function() {\n        return this._blue;\n      },\n      set: function(blue) {\n        if (!(Number(blue) === blue && blue % 1 === 0 && blue >= 0 && blue <= 255)) {\n          throw new Error('Blue must be an integer between 0 and 255.');\n        }\n        this._blue = blue;\n      }\n    });\n\n    Object.defineProperty(RGB.prototype, 'green', {\n      get: function() {\n        return this._green;\n      },\n      set: function(green) {\n        if (!(Number(green) === green && green % 1 === 0 && green >= 0 && green <= 255)) {\n          throw new Error('Green must be an integer between 0 and 255.');\n        }\n        this._green = green;\n      }\n    });\n\n    Object.defineProperty(RGB.prototype, 'red', {\n      get: function() {\n        return this._red;\n      },\n      set: function(red) {\n        if (!(Number(red) === red && red % 1 === 0 && red >= 0 && red <= 255)) {\n          throw new Error('Red must be an integer between 0 and 255.');\n        }\n        this._red = red;\n      }\n    });\n\n    return RGB;\n  }]);\n","angular\n  .module('d3Colors', ['color'])\n  .factory('D3Colors', [\n    'd3',\n    'HEX',\n    'HSL',\n    'RGB',\n    function (d3, HEX, HSL, RGB) {\n      /**\n       * D3Colors constructor object\n       */\n      function D3Colors (colors) {\n        this._colors = [];\n        this.colors = colors;\n      }\n\n      /**\n       * Assign constructor to itself\n       *\n       * @type {Function}\n       */\n      D3Colors.prototype.constructor = D3Colors;\n\n      D3Colors.prototype.getScaledFadedColors = function (steps) {\n        var fadedColors = [];\n        for (var i = 0, len = this.colors.length; i < len; i++) {\n          var hsl = this.colors[i].toHsl(),\n              colors = hsl.brighten(steps - 1, true);\n\n          // Prepend original color\n          colors.unshift(hsl);\n\n          // Convert HSL back to RGB\n          for (var j = 0; j < steps; j++) {\n            colors[j] = colors[j].toHex().toString();\n          }\n\n          // Merge set of fading colors\n          fadedColors = fadedColors.concat(colors);\n        }\n        return d3.scale.ordinal()\n          .domain(d3.range(this.colors.length * (steps + 1)))\n          .range(fadedColors);\n      };\n\n      Object.defineProperty(D3Colors.prototype, 'colors', {\n        get: function() {\n          return this._colors;\n        },\n        set: function(colors) {\n          if (!(colors && colors.length)) {\n            throw new Error('Colors needs to be an array.');\n          }\n          try {\n            for (var i = 0, len = colors.length; i < len; i++) {\n              this._colors.push(new HEX(colors[i]));\n            }\n          } catch (e) {\n            throw new Error('Colors needs to be an array.');\n          }\n        }\n      });\n\n      return D3Colors;\n    }\n  ]);\n","var GlobalEvents = (function () {\n  var private = {};\n\n  function GlobalEvents ($window, $, _) {\n    private.eventStack = {};\n\n    // Public\n    this._ = _;\n  }\n\n  GlobalEvents.prototype.off = function (event, index) {\n    if (event in private.eventStack && index in private.eventStack[event]) {\n      private.eventStack[event].splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n\n  GlobalEvents.prototype.on = function (event, callback) {\n    if (event in private.eventStack) {\n      private.eventStack[event].push(callback);\n    } else {\n      private.eventStack[event] = [callback];\n    }\n\n    return private.eventStack[event].length - 1;\n  };\n\n  GlobalEvents.prototype.trigger = function (event) {\n    if (event in private.eventStack) {\n      var stack = private.eventStack[event];\n      for (var i = 0, len = stack.length; i < len; i++) {\n        if (this._.isFunction(stack[i])) {\n          stack[i]();\n        }\n      }\n    }\n  };\n\n  return GlobalEvents;\n}());\n\nangular\n  .module('globalEvents')\n  .service('globalEvents', [\n    '$window',\n    '$',\n    '_',\n    GlobalEvents\n  ]);\n"],"sourceRoot":"/source/"}